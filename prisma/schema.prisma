generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Category {
  id        Int        @id @default(autoincrement())
  parentId  Int?
  title     String
  slug      String
  keywords  Json?
  parent    Category?  @relation("CategoryChildren", fields: [parentId], references: [id])
  children  Category[] @relation("CategoryChildren")
  createdAt DateTime   @default(now())

  @@unique([parentId, slug])
  @@index([parentId])
  @@index([slug])
  @@map("categories")
}

model Tag {
  id        Int      @id @default(autoincrement())
  name      String   @db.VarChar(255)
  slug      String   @unique @map("slug") @db.VarChar(255)
  createdAt DateTime @default(now()) @map("created_at")

  @@map("tags")
}

model Ingredient {
  id        BigInt   @id @default(autoincrement())
  name      String
  slug      String   @unique @db.VarChar(255)
  createdAt DateTime @default(now())

  @@map("ingredients")
}

model Phrase {
  id        BigInt   @id @default(autoincrement())
  sourceId  Int      @map("source_id")
  type      String   @default("default") @db.VarChar(32)
  version   String   @default("default") @db.VarChar(32)
  index     Int      @default(0)
  hash      String   @default("") @db.VarChar(64)
  text      String   @db.LongText
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([sourceId, hash, version, index])
  @@map("phrases")
}

model Source {
  id           Int           @id @default(autoincrement()) @map("id")
  recipeUrl    String        @unique @map("recipe_url")
  recipeDate   DateTime?     @map("recipe_date")
  htmlContent  String?       @map("html_content") @db.LongText
  jsonParsed   Json?         @map("json_parsed")
  jsonAltered  Json?         @map("json_altered")
  version      String        @default("v1") @db.VarChar(16)
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @default(now()) @updatedAt @map("updated_at")
  sourceImages SourceImage[]

  @@index([version])
  @@map("sources")
}

model SourceImage {
  id         Int      @id @default(autoincrement()) @map("id")
  sourceId   Int?     @map("source_id")
  stableId   String?  @map("stable_id") @db.Char(40)
  url        String?  @map("url") @db.Text
  alt        String?  @map("alt") @db.VarChar(1024)
  isLead     Boolean  @default(false) @map("is_lead")
  order      Int      @default(0) @map("order")
  downloaded Boolean  @default(false)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @default(now()) @updatedAt @map("updated_at")
  source     Source?  @relation(fields: [sourceId], references: [id])

  @@unique([sourceId, stableId])
  @@index([sourceId])
  @@index([order], map: "idx_recipe_images_step_order")
  @@map("source_images")
}
